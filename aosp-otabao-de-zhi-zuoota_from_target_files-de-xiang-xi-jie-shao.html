<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>AOSP OTA包的制作：ota_from_target_files 的详细介绍 - HEIN&#x27;s Blog</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="alternate" type="application/atom+xml" href="https://blog.nasyes.cn/feed.xml"><link rel="alternate" type="application/json" href="https://blog.nasyes.cn/feed.json"><meta property="og:title" content="AOSP OTA包的制作：ota_from_target_files 的详细介绍"><meta property="og:site_name" content="HEIN's Blog"><meta property="og:description" content="ota_from_target_files 是 Android 构建系统中的一个脚本，用于从生成的 target_files.zip 包中创建 OTA（Over-The-Air）更新包。该工具在 Android 固件更新和设备维护过程中非常关键，通常与 AOSP 编译过程一起使用。 ota_from_target_files 是 Android 的 releasetools 脚本之一，它的作用是从包含系统镜像、内核、启动映像、分区表等内容的 target_files.zip 中生成一个完整的 OTA 更新包（.zip 文件）。生成的 OTA 包可以用于通过 adb&hellip;"><meta property="og:url" content="https://blog.nasyes.cn/aosp-otabao-de-zhi-zuoota_from_target_files-de-xiang-xi-jie-shao.html"><meta property="og:type" content="article"><link rel="preload" href="https://blog.nasyes.cn/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://blog.nasyes.cn/assets/css/style.css?v=1f557c81d98d81d721608200b8db7e33"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nasyes.cn/aosp-otabao-de-zhi-zuoota_from_target_files-de-xiang-xi-jie-shao.html"},"headline":"AOSP OTA包的制作：ota_from_target_files 的详细介绍","datePublished":"2024-09-23T15:43+08:00","dateModified":"2024-09-26T11:33+08:00","description":"ota_from_target_files 是 Android 构建系统中的一个脚本，用于从生成的 target_files.zip 包中创建 OTA（Over-The-Air）更新包。该工具在 Android 固件更新和设备维护过程中非常关键，通常与 AOSP 编译过程一起使用。 ota_from_target_files 是 Android 的 releasetools 脚本之一，它的作用是从包含系统镜像、内核、启动映像、分区表等内容的 target_files.zip 中生成一个完整的 OTA 更新包（.zip 文件）。生成的 OTA 包可以用于通过 adb&hellip;","author":{"@type":"Person","name":"HEIN","url":"https://blog.nasyes.cn/authors/hein/"},"publisher":{"@type":"Organization","name":"HEIN"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://blog.nasyes.cn/">HEIN&#x27;s Blog</a></div></header><main class="content"><article class="post"><header><h1 class="post__title">AOSP OTA包的制作：ota_from_target_files 的详细介绍</h1><div class="post__meta"><time datetime="2024-09-23T15:43" class="post__date">九月 23, 2024 </time><span class="post__author"><a href="https://blog.nasyes.cn/authors/hein/" class="feed__author">HEIN</a></span></div></header><div class="post__entry"><p><code>ota_from_target_files</code> 是 Android 构建系统中的一个脚本，用于从生成的 <code>target_files.zip</code> 包中创建 OTA（Over-The-Air）更新包。该工具在 Android 固件更新和设备维护过程中非常关键，通常与 AOSP 编译过程一起使用。</p><h3 id="1-什么是-ota_from_target_files">1. 什么是 <code>ota_from_target_files</code></h3><p><code>ota_from_target_files</code> 是 Android 的 <code>releasetools</code> 脚本之一，它的作用是从包含系统镜像、内核、启动映像、分区表等内容的 <code>target_files.zip</code> 中生成一个完整的 OTA 更新包（<code>.zip</code> 文件）。生成的 OTA 包可以用于通过 <code>adb sideload</code> 或者直接通过系统的 OTA 机制进行升级。<br></p><figure class="post__image"><img loading="lazy" src="https://blog.nasyes.cn/media/posts/6/releasetools-3.jpg" alt="AOSP中的releasetools" width="1268" height="673" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://blog.nasyes.cn/media/posts/6/responsive/releasetools-3-xs.jpg 300w, https://blog.nasyes.cn/media/posts/6/responsive/releasetools-3-sm.jpg 480w, https://blog.nasyes.cn/media/posts/6/responsive/releasetools-3-md.jpg 768w, https://blog.nasyes.cn/media/posts/6/responsive/releasetools-3-lg.jpg 1024w"></figure><h3 id="2-使用场景">2. 使用场景</h3><ul><li><strong>完整 OTA 包</strong>: 提供整个系统的更新。</li><li><strong>增量 OTA 包</strong>: 提供基于之前版本的增量更新包，从而减少更新包的大小。</li></ul><h3 id="3-ota_from_target_files-的主要参数">3. <code>ota_from_target_files</code> 的主要参数</h3><p>运行 <code>ota_from_target_files</code> 命令时，你可以指定多个选项和参数来控制输出的 OTA 包内容和格式。以下是一些常用的选项：</p><ul><li><code>--block</code>: 强制生成基于块的 OTA 包，而不是文件级别的更新。这种方式更适合现代设备，因为它更快且更安全。</li><li><code>--incremental_from=&lt;old_target_files.zip&gt;</code>: 指定增量更新的起始版本（即之前的系统版本），生成一个增量 OTA 包。增量 OTA 包只包含相对于旧版本的变化，从而使更新包更小。</li><li><code>--full_radio</code>: OTA 包中包括完整的 <code>radio.img</code> 文件，而不是增量。</li><li><code>--full_bootloader</code>: OTA 包中包括完整的 <code>bootloader.img</code> 文件，而不是增量。</li><li><code>--wipe_user_data</code>: 生成的 OTA 包会在更新时清除用户数据。</li><li><code>--downgrade</code>: 允许 OTA 包支持系统降级，这对于将设备恢复到早期版本时有用。</li></ul><h3 id="4-基本使用示例">4. 基本使用示例</h3><h4 id="41-创建完整-ota-包">4.1 创建完整 OTA 包</h4><p>完整 OTA 包会包含系统的全部内容，适用于首次安装或者大版本更新。</p><pre><code class="language-bash">python3 build/tools/releasetools/ota_from_target_files -v \
    out/target/product/&lt;device&gt;/obj/PACKAGING/target_files_intermediates/&lt;device&gt;-target_files-*.zip \
    out/target/product/&lt;device&gt;/ota_update_full.zip
</code></pre><ul><li><code>&lt;device&gt;</code>: 设备的代码名。</li><li><code>out/target/product/&lt;device&gt;/obj/PACKAGING/target_files_intermediates/&lt;device&gt;-target_files-*.zip</code>: 这是已经通过 <code>make target-files-package</code> 生成的目标文件包。</li><li><code>out/target/product/&lt;device&gt;/ota_update_full.zip</code>: 生成的完整 OTA 更新包。</li></ul><figure class="post__image"><img loading="lazy" src="https://blog.nasyes.cn/media/posts/6/ota_files.jpg" alt="ota_files" width="1392" height="1088" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://blog.nasyes.cn/media/posts/6/responsive/ota_files-xs.jpg 300w, https://blog.nasyes.cn/media/posts/6/responsive/ota_files-sm.jpg 480w, https://blog.nasyes.cn/media/posts/6/responsive/ota_files-md.jpg 768w, https://blog.nasyes.cn/media/posts/6/responsive/ota_files-lg.jpg 1024w"></figure><h4 id="42-创建增量-ota-包">4.2 创建增量 OTA 包</h4><p>增量 OTA 包包含的是相对于旧版本的差异部分，适合系统的更新和小版本升级。</p><pre><code class="language-bash">python3 build/tools/releasetools/ota_from_target_files -v \
    --incremental_from=out/target/product/&lt;device&gt;/obj/PACKAGING/target_files_intermediates/&lt;device&gt;-old_target_files-*.zip \
    out/target/product/&lt;device&gt;/obj/PACKAGING/target_files_intermediates/&lt;device&gt;-target_files-*.zip \
    out/target/product/&lt;device&gt;/ota_update_incremental.zip
</code></pre><ul><li><code>--incremental_from</code>: 指定旧版本的 <code>target_files.zip</code>，用来生成增量 OTA 包。</li><li><code>out/target/product/&lt;device&gt;/ota_update_incremental.zip</code>: 生成的增量 OTA 更新包。</li></ul><h4 id="43-基于块的-ota-包">4.3 基于块的 OTA 包</h4><p>使用 <code>--block</code> 选项生成基于块的 OTA 包，这种更新方式更直接，适合现代 Android 设备。</p><pre><code class="language-bash">python3 build/tools/releasetools/ota_from_target_files -v --block \
    out/target/product/&lt;device&gt;/obj/PACKAGING/target_files_intermediates/&lt;device&gt;-target_files-*.zip \
    out/target/product/&lt;device&gt;/ota_update_block.zip
</code></pre><h3 id="5-解压和检查-target_fileszip">5. 解压和检查 <code>target_files.zip</code></h3><p>在使用 <code>ota_from_target_files</code> 之前，你可能需要检查 <code>target_files.zip</code> 包的内容。你可以通过解压缩来查看其结构：</p><pre><code class="language-bash">unzip out/target/product/&lt;device&gt;/obj/PACKAGING/target_files_intermediates/&lt;device&gt;-target_files-*.zip -d /tmp/target_files
</code></pre><p>解压缩后，<code>target_files.zip</code> 的目录结构通常如下：</p><pre><code>META/
BOOT/
RECOVERY/
SYSTEM/
VENDOR/
RADIO/
</code></pre><ul><li><code>META/</code>: 包含签名、更新脚本、<code>misc_info.txt</code> 等。</li><li><code>BOOT/</code>: 包含 <code>boot.img</code>。</li><li><code>RECOVERY/</code>: 包含 <code>recovery.img</code>。</li><li><code>SYSTEM/</code>: 系统分区内容。</li><li><code>VENDOR/</code>: 供应商分区内容。</li><li><code>RADIO/</code>: 包含 <code>radio.img</code> 和 <code>bootloader.img</code> 等。</li></ul><h3 id="6-常见问题排查">6. 常见问题排查</h3><h4 id="61-misc_infotxt-缺失">6.1 <code>misc_info.txt</code> 缺失</h4><p><code>misc_info.txt</code> 是 <code>META</code> 目录下的文件，包含系统更新的配置信息。如果生成 OTA 包时提示 <code>misc_info.txt</code> 缺失，可能是因为 <code>target_files.zip</code> 中的设备配置不完整。你需要检查设备的 <code>BoardConfig.mk</code> 是否正确配置，确保包含所有必需的分区信息。</p><h4 id="62-增量-ota-包无法生成">6.2 增量 OTA 包无法生成</h4><p>增量 OTA 包生成失败时，可能是由于旧的 <code>target_files.zip</code> 与新的不兼容。例如，系统中的分区布局或签名方式发生了改变。确保旧版本的 <code>target_files.zip</code> 与新版本之间的变化只限于系统级别更新，不涉及分区或签名变化。</p><h4 id="63-aosp-14上在buildtoolsreleasetools-目录下面找不到ota_from_target_files-这个工具">6.3 AOSP 14上在build/tools/releasetools/ 目录下面找不到ota_from_target_files 这个工具</h4><p><code>ota_from_target_files</code> 工具在 AOSP 14 中是通过 <code>make</code> 过程生成的，而不是在源代码中直接提供。通常，<code>ota_from_target_files</code> 是在构建 AOSP 时动态生成的。它位于 <code>out/host/linux-x86/bin/</code> 目录下。</p><figure class="post__image"><img loading="lazy" src="https://blog.nasyes.cn/media/posts/6/new_ota_releasetools.jpg" alt="new_ota_releasetools" width="1387" height="755" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://blog.nasyes.cn/media/posts/6/responsive/new_ota_releasetools-xs.jpg 300w, https://blog.nasyes.cn/media/posts/6/responsive/new_ota_releasetools-sm.jpg 480w, https://blog.nasyes.cn/media/posts/6/responsive/new_ota_releasetools-md.jpg 768w, https://blog.nasyes.cn/media/posts/6/responsive/new_ota_releasetools-lg.jpg 1024w"></figure><h3 id="7-使用-adb-sideload-刷写-ota-包">7. 使用 <code>adb sideload</code> 刷写 OTA 包</h3><p>生成 OTA 包后，你可以通过 <code>adb sideload</code> 将 OTA 包刷写到设备上：</p><pre><code class="language-bash">adb reboot recovery
adb sideload out/target/product/&lt;device&gt;/ota_update_full.zip
</code></pre><p>设备进入恢复模式后，通过 <code>adb sideload</code> 命令加载并安装 OTA 包。</p><h3 id="8-总结">8. 总结</h3><p><code>ota_from_target_files</code> 工具是 Android 构建系统中关键的一部分，用于生成适用于 OTA 更新的 <code>.zip</code> 包。通过正确配置和使用该工具，你可以生成完整或增量的 OTA 包，并使用这些包进行系统升级。</p><p>===========The End===========</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 九月 26, 2024</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://blog.nasyes.cn/gptche-lian-wang-tboxyi-ban-yun-xing-shi-me-cao-zuo-xi-tongyou-na-xie-kai-yuan-shi-xian.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  [GPT]车联网TBox一般运行什么操作系统，有哪些开源实现？ "><span class="btn__icon">←</span> <span class="btn__text">[GPT]车联网TBox一般运行什么操作系统，有哪些开源实现？</span> </a><a href="https://blog.nasyes.cn/aosp-otade-ying-yongupdateengineliu-cheng-jie-du.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  AOSP OTA包的应用：update_engine模块解读 "><span class="btn__text">AOSP OTA包的应用：update_engine模块解读</span> <span class="btn__icon">→</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>© 2024 Powered by Publii CMS :: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank" rel="noopener">Theme</a> ported by the <a href="https://getpublii.com/customization-service/" target="_blank" rel="noopener">Publii Team</a></p></div></div></footer></div><script defer="defer" src="https://blog.nasyes.cn/assets/js/scripts.min.js?v=74fad06980c30243d91d72c7c57fcdb8"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>