<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>AOSP FWK 添加新方法报错：New API must be flagged with @FlaggedApi - HEIN&#x27;s Blog</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="alternate" type="application/atom+xml" href="https://blog.nasyes.cn/feed.xml" title="HEIN&#x27;s Blog - RSS"><link rel="alternate" type="application/json" href="https://blog.nasyes.cn/feed.json" title="HEIN&#x27;s Blog - JSON"><meta property="og:title" content="AOSP FWK 添加新方法报错：New API must be flagged with @FlaggedApi"><meta property="og:site_name" content="HEIN's Blog"><meta property="og:description" content="在编译 AOSP（Android Open Source Project）时，如果你增加了一个新的静态方法并且遇到了报错，可参考以下方法解决。 没有正确标记新 API： 在 AOSP 中，添加新的 API 或更改现有的 API 需要符合严格的规范。例如，在 Android 框架代码中增加或修改 API 需要使用特定的注释（annotations），如 @FlaggedApi、@SystemApi、@TestApi 等。 如果新增加的静态方法没有正确标记或不符合 API 的规范要求，编译时会出现错误。 解决方法： 使用适当的注解来标记新的静态方法。例如：&hellip;"><meta property="og:url" content="https://blog.nasyes.cn/aosp-fwk-tian-jia-xin-fang-fa-bao-cuonew-api-must-be-flagged-with-flaggedapi.html"><meta property="og:type" content="article"><link rel="preload" href="https://blog.nasyes.cn/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://blog.nasyes.cn/assets/css/style.css?v=1f557c81d98d81d721608200b8db7e33"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nasyes.cn/aosp-fwk-tian-jia-xin-fang-fa-bao-cuonew-api-must-be-flagged-with-flaggedapi.html"},"headline":"AOSP FWK 添加新方法报错：New API must be flagged with @FlaggedApi","datePublished":"2024-09-03T15:22+08:00","dateModified":"2024-09-26T11:32+08:00","description":"在编译 AOSP（Android Open Source Project）时，如果你增加了一个新的静态方法并且遇到了报错，可参考以下方法解决。 没有正确标记新 API： 在 AOSP 中，添加新的 API 或更改现有的 API 需要符合严格的规范。例如，在 Android 框架代码中增加或修改 API 需要使用特定的注释（annotations），如 @FlaggedApi、@SystemApi、@TestApi 等。 如果新增加的静态方法没有正确标记或不符合 API 的规范要求，编译时会出现错误。 解决方法： 使用适当的注解来标记新的静态方法。例如：&hellip;","author":{"@type":"Person","name":"HEIN","url":"https://blog.nasyes.cn/authors/hein/"},"publisher":{"@type":"Organization","name":"HEIN"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://blog.nasyes.cn/">HEIN&#x27;s Blog</a></div></header><main class="content"><article class="post"><header><h1 class="post__title">AOSP FWK 添加新方法报错：New API must be flagged with @FlaggedApi</h1><div class="post__meta"><time datetime="2024-09-03T15:22" class="post__date">九月 3, 2024 </time><span class="post__author"><a href="https://blog.nasyes.cn/authors/hein/" class="feed__author">HEIN</a></span></div></header><div class="post__entry"><p>在编译 AOSP（Android Open Source Project）时，如果你增加了一个新的静态方法并且遇到了报错，可参考以下方法解决。</p><h3 id="常见原因及解决方法">常见原因及解决方法</h3><ol><li><p><strong>没有正确标记新 API</strong>： 在 AOSP 中，添加新的 API 或更改现有的 API 需要符合严格的规范。例如，在 Android 框架代码中增加或修改 API 需要使用特定的注释（annotations），如 <code>@FlaggedApi</code>、<code>@SystemApi</code>、<code>@TestApi</code> 等。</p><p>如果新增加的静态方法没有正确标记或不符合 API 的规范要求，编译时会出现错误。</p><p><strong>解决方法</strong>： 使用适当的注解来标记新的静态方法。例如：</p><pre><code class="language-java">@FlaggedApi(&quot;Sth to describe the method.&quot;)
public static void myNewStaticMethod() {
    // method implementation
}
</code></pre></li><li><p><strong>API 签名检查失败</strong>： 当你在 AOSP 中增加或更改 API 时，编译过程会检查这些更改是否符合 <code>current.txt</code>、<code>removed.txt</code> 等 API 签名文件的定义。如果增加的 API 不在这些文件中，编译会失败。</p><p><strong>解决方法</strong>：</p><ul><li>更新相关的 API 签名文件，例如 <code>frameworks/base/api/current.txt</code>，将新增的 API 签名添加到该文件中。</li><li>运行以下命令来生成和更新 API 签名：<pre><code class="language-bash">make update-api
</code></pre></li></ul><p>这将自动更新 API 文件以匹配你所做的更改。</p></li><li><p><strong>Java 语言层级不匹配</strong>： AOSP 使用特定的 Java 语言版本来编译代码。确保你使用的语法和语言特性与 AOSP 项目的 Java 编译器设置相匹配。</p><p><strong>解决方法</strong>：</p><ul><li>确保你的代码没有使用高于当前 AOSP 项目所支持的 Java 版本的特性。</li></ul></li><li><p><strong>依赖库或模块缺失</strong>： 如果你的新方法使用了某些依赖，但这些依赖没有被正确地添加到相应的 <code>Android.bp</code> 或 <code>Android.mk</code> 构建文件中，也可能会导致编译错误。</p><p><strong>解决方法</strong>：</p><ul><li>确保所有需要的依赖和模块已经在相应的构建文件中正确声明。</li></ul></li><li><p><strong>ProGuard 混淆规则冲突</strong>： 如果你在 <code>proguard-rules.pro</code> 文件中定义了混淆规则，这些规则可能会与新的静态方法发生冲突，导致编译错误。</p><p><strong>解决方法</strong>：</p><ul><li>检查混淆规则文件，并确保其中的规则不会对新增加的静态方法产生不良影响。</li></ul></li></ol><h3 id="如何进一步排查问题">如何进一步排查问题</h3><ul><li><strong>查看详细错误信息</strong>：编译 AOSP 时，查看输出日志中的错误信息，它通常会指出错误的具体位置和原因。</li><li><strong>检查更改的文件</strong>：确保你修改的文件没有其他编译器不支持的更改。</li><li><strong>清理构建环境</strong>：尝试清理构建环境，重新构建项目：<pre><code class="language-bash">make clean
make
</code></pre></li></ul></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on 九月 26, 2024</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://blog.nasyes.cn/openharmonyzai-shu-mei-pai-4shang-de-chu-bu-yi-zhi-he-bian-yishua-jidiao-shi.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  OpenHarmony在树莓派4B上的初步移植和编译、刷机 "><span class="btn__icon">←</span> <span class="btn__text">OpenHarmony在树莓派4B上的初步移植和编译、刷机</span> </a><a href="https://blog.nasyes.cn/gptche-lian-wang-tboxyi-ban-yun-xing-shi-me-cao-zuo-xi-tongyou-na-xie-kai-yuan-shi-xian.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  车联网TBox一般运行什么操作系统，有哪些开源实现？ "><span class="btn__text">车联网TBox一般运行什么操作系统，有哪些开源实现？</span> <span class="btn__icon">→</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>© 2024 Powered by Publii CMS :: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank" rel="noopener">Theme</a> ported by the <a href="https://getpublii.com/customization-service/" target="_blank" rel="noopener">Publii Team</a></p></div></div></footer></div><script defer="defer" src="https://blog.nasyes.cn/assets/js/scripts.min.js?v=74fad06980c30243d91d72c7c57fcdb8"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>