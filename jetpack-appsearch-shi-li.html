<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Jetpack AppSearch ç¤ºä¾‹ - HEIN&#x27;s Blog</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="alternate" type="application/atom+xml" href="https://blog.nasyes.cn/feed.xml" title="HEIN&#x27;s Blog - RSS"><link rel="alternate" type="application/json" href="https://blog.nasyes.cn/feed.json" title="HEIN&#x27;s Blog - JSON"><meta property="og:title" content="Jetpack AppSearch ç¤ºä¾‹"><meta property="og:site_name" content="HEIN's Blog"><meta property="og:description" content="Jetpack AppSearchï¼ˆJavaï¼ŒAndroid 9 å¯ç”¨ï¼‰å¢ / åˆ  / æ”¹ / æŸ¥ï¼ˆCRUDï¼‰ç¤ºä¾‹ã€‚ æˆ‘ä¼šæŒ‰çœŸå®å·¥ç¨‹ç»“æ„æ¥å†™ï¼Œè€Œä¸æ˜¯é›¶æ•£ä»£ç ï¼Œä¿è¯ä½ å¤åˆ¶åå°±èƒ½ç”¨ã€‚ é€‚ç”¨å‰æ dependencies { implementation &quot;androidx.appsearch:appsearch:1.1.0&quot; implementation &quot;androidx.appsearch:appsearch-local-storage:1.1.0&quot; } äºŒã€Schema å®šä¹‰ï¼ˆMusic ç¤ºä¾‹ï¼‰ import androidx.appsearch.annotation.Document; import&hellip;"><meta property="og:url" content="https://blog.nasyes.cn/jetpack-appsearch-shi-li.html"><meta property="og:type" content="article"><link rel="preload" href="https://blog.nasyes.cn/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://blog.nasyes.cn/assets/css/style.css?v=1f557c81d98d81d721608200b8db7e33"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.nasyes.cn/jetpack-appsearch-shi-li.html"},"headline":"Jetpack AppSearch ç¤ºä¾‹","datePublished":"2026-01-07T17:05+08:00","dateModified":"2026-01-07T17:05+08:00","description":"Jetpack AppSearchï¼ˆJavaï¼ŒAndroid 9 å¯ç”¨ï¼‰å¢ / åˆ  / æ”¹ / æŸ¥ï¼ˆCRUDï¼‰ç¤ºä¾‹ã€‚ æˆ‘ä¼šæŒ‰çœŸå®å·¥ç¨‹ç»“æ„æ¥å†™ï¼Œè€Œä¸æ˜¯é›¶æ•£ä»£ç ï¼Œä¿è¯ä½ å¤åˆ¶åå°±èƒ½ç”¨ã€‚ é€‚ç”¨å‰æ dependencies { implementation &quot;androidx.appsearch:appsearch:1.1.0&quot; implementation &quot;androidx.appsearch:appsearch-local-storage:1.1.0&quot; } äºŒã€Schema å®šä¹‰ï¼ˆMusic ç¤ºä¾‹ï¼‰ import androidx.appsearch.annotation.Document; import&hellip;","author":{"@type":"Person","name":"HEIN","url":"https://blog.nasyes.cn/authors/hein/"},"publisher":{"@type":"Organization","name":"HEIN"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://blog.nasyes.cn/">HEIN&#x27;s Blog</a></div></header><main class="content"><article class="post"><header><h1 class="post__title">Jetpack AppSearch ç¤ºä¾‹</h1><div class="post__meta"><time datetime="2026-01-07T17:05" class="post__date">ä¸€æœˆ 7, 2026 </time><span class="post__author"><a href="https://blog.nasyes.cn/authors/hein/" class="feed__author">HEIN</a></span></div></header><div class="post__entry"><p><strong>Jetpack AppSearchï¼ˆJavaï¼ŒAndroid 9 å¯ç”¨ï¼‰å¢ / åˆ  / æ”¹ / æŸ¥ï¼ˆCRUDï¼‰ç¤ºä¾‹</strong>ã€‚ æˆ‘ä¼šæŒ‰<strong>çœŸå®å·¥ç¨‹ç»“æ„</strong>æ¥å†™ï¼Œè€Œä¸æ˜¯é›¶æ•£ä»£ç ï¼Œä¿è¯ä½ å¤åˆ¶åå°±èƒ½ç”¨ã€‚</p><blockquote><p>é€‚ç”¨å‰æ</p><ul><li>Android 9ï¼ˆAPI 28ï¼‰</li><li><code>appsearch-local-storage</code></li><li>Java</li><li>å¤šç±»å‹æ•°æ®ï¼ˆç¤ºä¾‹ç”¨ Musicï¼‰</li></ul></blockquote><hr><h1 id="ä¸€ã€ä¾èµ–ï¼ˆå†æ¬¡ç¡®è®¤ï¼‰">ä¸€ã€ä¾èµ–ï¼ˆå†æ¬¡ç¡®è®¤ï¼‰</h1><pre><code class="language-gradle">dependencies {
    implementation &quot;androidx.appsearch:appsearch:1.1.0&quot;
    implementation &quot;androidx.appsearch:appsearch-local-storage:1.1.0&quot;
}
</code></pre><hr><h1 id="äºŒã€schema-å®šä¹‰ï¼ˆmusic-ç¤ºä¾‹ï¼‰">äºŒã€Schema å®šä¹‰ï¼ˆMusic ç¤ºä¾‹ï¼‰</h1><pre><code class="language-java">import androidx.appsearch.annotation.Document;
import androidx.appsearch.app.StringPropertyConfig;

@Document(name = &quot;Music&quot;)
public class MusicDoc {

    @Document.Id
    public String id;

    @Document.Namespace
    public String namespace = &quot;music&quot;;

    @Document.StringProperty(
            indexingType = StringPropertyConfig.INDEXING_TYPE_PREFIXES
    )
    public String title;

    @Document.StringProperty(
            indexingType = StringPropertyConfig.INDEXING_TYPE_PREFIXES
    )
    public String artist;

    @Document.StringProperty
    public String intentUri;

    public MusicDoc() {}

    public MusicDoc(String id, String title, String artist, String intentUri) {
        this.id = id;
        this.title = title;
        this.artist = artist;
        this.intentUri = intentUri;
    }
}
</code></pre><hr><h1 id="ä¸‰ã€appsearch-session-ç®¡ç†ï¼ˆå•ä¾‹ï¼‰">ä¸‰ã€AppSearch Session ç®¡ç†ï¼ˆå•ä¾‹ï¼‰</h1><pre><code class="language-java">import android.content.Context;
import androidx.appsearch.app.AppSearchSession;
import androidx.appsearch.localstorage.LocalStorage;

import java.util.concurrent.ExecutionException;

public class AppSearchHelper {

    private static AppSearchSession session;

    public static AppSearchSession get(Context context)
            throws ExecutionException, InterruptedException {

        if (session == null) {
            session = LocalStorage.createSearchSessionAsync(
                    new LocalStorage.SearchContext.Builder(
                            context,
                            &quot;global_search_db&quot;
                    ).build()
            ).get();
        }
        return session;
    }
}
</code></pre><hr><h1 id="å››ã€åˆå§‹åŒ–-schemaï¼ˆå¿…é¡»æ‰§è¡Œä¸€æ¬¡ï¼‰">å››ã€åˆå§‹åŒ– Schemaï¼ˆå¿…é¡»æ‰§è¡Œä¸€æ¬¡ï¼‰</h1><pre><code class="language-java">import androidx.appsearch.app.SetSchemaRequest;

public class SearchInit {

    public static void init(Context context)
            throws ExecutionException, InterruptedException {

        AppSearchSession session = AppSearchHelper.get(context);

        SetSchemaRequest request =
                new SetSchemaRequest.Builder()
                        .addDocumentClasses(MusicDoc.class)
                        .build();

        session.setSchemaAsync(request).get();
    }
}
</code></pre><hr><h1 id="äº”ã€crud-æ“ä½œå°è£…ï¼ˆé‡ç‚¹ï¼‰">äº”ã€CRUD æ“ä½œå°è£…ï¼ˆé‡ç‚¹ï¼‰</h1><p>ä¸‹é¢æ˜¯<strong>çœŸæ­£å·¥ç¨‹é‡Œä½ ä¼šé•¿æœŸç”¨çš„ç±»</strong>ã€‚</p><hr><h2 id="1ï¸âƒ£-createï¼ˆæ–°å¢ï¼‰">1ï¸âƒ£ Createï¼ˆæ–°å¢ï¼‰</h2><pre><code class="language-java">import androidx.appsearch.app.PutDocumentsRequest;

public class MusicRepository {

    public static void insert(Context context, MusicDoc music)
            throws ExecutionException, InterruptedException {

        AppSearchSession session = AppSearchHelper.get(context);

        PutDocumentsRequest request =
                new PutDocumentsRequest.Builder()
                        .addDocuments(music)
                        .build();

        session.putAsync(request).get();
    }
}
</code></pre><h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3><pre><code class="language-java">MusicRepository.insert(
        context,
        new MusicDoc(
                &quot;music_1001&quot;,
                &quot;Yesterday&quot;,
                &quot;Beatles&quot;,
                &quot;app://music/play/1001&quot;
        )
);
</code></pre><hr><h2 id="2ï¸âƒ£-readï¼ˆæŸ¥è¯¢--æœç´¢ï¼‰">2ï¸âƒ£ Readï¼ˆæŸ¥è¯¢ / æœç´¢ï¼‰</h2><h3 id="21-å…³é”®è¯æœç´¢">2.1 å…³é”®è¯æœç´¢</h3><pre><code class="language-java">import androidx.appsearch.app.SearchResults;
import androidx.appsearch.app.SearchSpec;
import androidx.appsearch.app.SearchResult;

import java.util.ArrayList;
import java.util.List;

public static List&lt;MusicDoc&gt; search(Context context, String keyword)
        throws ExecutionException, InterruptedException {

    AppSearchSession session = AppSearchHelper.get(context);

    SearchSpec spec =
            new SearchSpec.Builder()
                    .addSchemaType(&quot;Music&quot;)
                    .setResultCountPerPage(20)
                    .build();

    SearchResults results = session.search(keyword, spec);

    List&lt;MusicDoc&gt; list = new ArrayList&lt;&gt;();

    for (SearchResult result : results.nextPageAsync().get()) {
        list.add(result.getDocument(MusicDoc.class));
    }

    return list;
}
</code></pre><hr><h3 id="22-æŒ‰-id-ç²¾ç¡®è¯»å–ï¼ˆéå¸¸å®ç”¨ï¼‰">2.2 æŒ‰ ID ç²¾ç¡®è¯»å–ï¼ˆéå¸¸å®ç”¨ï¼‰</h3><pre><code class="language-java">import androidx.appsearch.app.GetByDocumentIdRequest;

public static MusicDoc getById(Context context, String id)
        throws ExecutionException, InterruptedException {

    AppSearchSession session = AppSearchHelper.get(context);

    GetByDocumentIdRequest request =
            new GetByDocumentIdRequest.Builder(&quot;music&quot;)
                    .addIds(id)
                    .build();

    return session.getByDocumentIdAsync(request)
            .get()
            .getSuccesses()
            .get(id)
            .toDocumentClass(MusicDoc.class);
}
</code></pre><hr><h2 id="3ï¸âƒ£-updateï¼ˆä¿®æ”¹ï¼‰">3ï¸âƒ£ Updateï¼ˆä¿®æ”¹ï¼‰</h2><p>âš ï¸ <strong>é‡ç‚¹æ¦‚å¿µï¼šAppSearch æ²¡æœ‰â€œå•ç‹¬çš„ update APIâ€ï¼Œ<code>put</code> = insert or replace</strong></p><h3 id="æ­£ç¡®æ›´æ–°æ–¹å¼">æ­£ç¡®æ›´æ–°æ–¹å¼</h3><pre><code class="language-java">public static void update(Context context, MusicDoc updated)
        throws ExecutionException, InterruptedException {

    // id + namespace ç›¸åŒ = è¦†ç›–
    insert(context, updated);
}
</code></pre><h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3><pre><code class="language-java">MusicDoc music = MusicRepository.getById(context, &quot;music_1001&quot;);
music.artist = &quot;The Beatles&quot;;

MusicRepository.update(context, music);
</code></pre><hr><h2 id="4ï¸âƒ£-deleteï¼ˆåˆ é™¤ï¼‰">4ï¸âƒ£ Deleteï¼ˆåˆ é™¤ï¼‰</h2><h3 id="41-æŒ‰-id-åˆ é™¤ï¼ˆæœ€å¸¸ç”¨ï¼‰">4.1 æŒ‰ ID åˆ é™¤ï¼ˆæœ€å¸¸ç”¨ï¼‰</h3><pre><code class="language-java">import androidx.appsearch.app.RemoveByDocumentIdRequest;

public static void deleteById(Context context, String id)
        throws ExecutionException, InterruptedException {

    AppSearchSession session = AppSearchHelper.get(context);

    RemoveByDocumentIdRequest request =
            new RemoveByDocumentIdRequest.Builder(&quot;music&quot;)
                    .addIds(id)
                    .build();

    session.removeAsync(request).get();
}
</code></pre><hr><h3 id="42-åˆ é™¤æ•´ä¸ªç±»å‹ï¼ˆå¯é€‰ï¼‰">4.2 åˆ é™¤æ•´ä¸ªç±»å‹ï¼ˆå¯é€‰ï¼‰</h3><pre><code class="language-java">import androidx.appsearch.app.RemoveBySchemaTypeRequest;

public static void deleteAll(Context context)
        throws ExecutionException, InterruptedException {

    AppSearchSession session = AppSearchHelper.get(context);

    RemoveBySchemaTypeRequest request =
            new RemoveBySchemaTypeRequest.Builder(&quot;Music&quot;)
                    .build();

    session.removeAsync(request).get();
}
</code></pre><hr><h1 id="å…­ã€å®Œæ•´-crud-è°ƒç”¨æµç¨‹ç¤ºä¾‹ï¼ˆä¸²èµ·æ¥ï¼‰">å…­ã€å®Œæ•´ CRUD è°ƒç”¨æµç¨‹ç¤ºä¾‹ï¼ˆä¸²èµ·æ¥ï¼‰</h1><pre><code class="language-java">// 1. åˆå§‹åŒ–
SearchInit.init(context);

// 2. æ–°å¢
MusicRepository.insert(
        context,
        new MusicDoc(&quot;music_1&quot;, &quot;Hello&quot;, &quot;Adele&quot;, &quot;app://music/play/1&quot;)
);

// 3. æŸ¥è¯¢
List&lt;MusicDoc&gt; result = MusicRepository.search(context, &quot;Hello&quot;);

// 4. ä¿®æ”¹
MusicDoc doc = MusicRepository.getById(context, &quot;music_1&quot;);
doc.artist = &quot;ADELE&quot;;
MusicRepository.update(context, doc);

// 5. åˆ é™¤
MusicRepository.deleteById(context, &quot;music_1&quot;);
</code></pre><hr><h1 id="ä¸ƒã€è¿™å¥—-crud-æ–¹æ¡ˆçš„å·¥ç¨‹çº§ä¼˜ç‚¹">ä¸ƒã€è¿™å¥— CRUD æ–¹æ¡ˆçš„å·¥ç¨‹çº§ä¼˜ç‚¹</h1><p>âœ… Android 9 å®Œå…¨å¯ç”¨ âœ… å¤šç±»å‹å¯å¹³è¡Œæ‰©å±•ï¼ˆOrder / App / Game ç›´æ¥å¤åˆ¶ä¸€å¥—ï¼‰ âœ… åˆ é™¤åç«‹å³ä¸å¯æœç´¢ï¼ˆå¼ºä¸€è‡´ï¼‰ âœ… æ›´æ–°é€»è¾‘ç®€å•ï¼ˆput è¦†ç›–ï¼‰ âœ… ç¬¦åˆ AOSP AppSearch æ€ç»´æ¨¡å‹</p><hr><h1 id="å…«ã€ä½ æ¥ä¸‹æ¥æœ€å¯èƒ½éœ€è¦çš„ä¸‰ä»¶äº‹">å…«ã€ä½ æ¥ä¸‹æ¥æœ€å¯èƒ½éœ€è¦çš„ä¸‰ä»¶äº‹</h1><p>å¦‚æœä½ ç»§ç»­å¾€ä¸‹åšï¼Œ<strong>100% ä¼šé‡åˆ°</strong>ï¼š</p><ol><li>ğŸ” <strong>ä¸šåŠ¡ DB â†” AppSearch çš„åŒæ­¥ç­–ç•¥</strong></li><li>ğŸ“Š <strong>å¤š Schema ç»Ÿä¸€æœç´¢ + åˆ†ç±»æ’åº</strong></li><li>ğŸš— <strong>è½¦æœº / Launcher æœç´¢æ€§èƒ½ä¼˜åŒ–</strong></li></ol><hr><hr><p><strong>éå¸¸å·¥ç¨‹åŒ–ã€ä¹Ÿæ˜¯ä½ è¿™ä¸ªç³»ç»Ÿèƒ½å¦é•¿æœŸç¨³å®šè¿è¡Œçš„å…³é”®</strong>ã€‚ ä¸‹é¢æˆ‘ç›´æ¥ç»™ä½ ä¸€å¥—**â€œä¸šåŠ¡æ•°æ®åº“ â†” AppSearch ç´¢å¼•â€åŒæ­¥çš„å®Œæ•´æ–¹æ¡ˆ**ï¼ŒåŒ…å«ï¼š</p><ol><li>âœ… <strong>æ¨èçš„æ€»ä½“æ¶æ„</strong></li><li>âœ… <strong>åŒæ­¥æ—¶æœºä¸ç­–ç•¥ï¼ˆå¢ / æ”¹ / åˆ ï¼‰</strong></li><li>âœ… <strong>Java ä»£ç æ¨¡æ¿ï¼ˆå¯ç›´æ¥ç”¨ï¼‰</strong></li><li>âœ… <strong>å¼‚å¸¸å…œåº•ä¸é‡å»ºæœºåˆ¶</strong></li><li>âœ… <strong>ä½ è¿™ç§å¤šç±»å‹åœºæ™¯çš„è½åœ°å»ºè®®</strong></li></ol><p>ä¸ç©æ¦‚å¿µï¼Œå…¨éƒ¨æ˜¯å®æˆ˜æ–¹æ¡ˆã€‚</p><hr><h1 id="ä¸€ã€æ ¸å¿ƒç»“è®ºï¼ˆå…ˆç»™ä½ åƒå®šå¿ƒä¸¸ï¼‰">ä¸€ã€æ ¸å¿ƒç»“è®ºï¼ˆå…ˆç»™ä½ åƒå®šå¿ƒä¸¸ï¼‰</h1><blockquote><p><strong>AppSearch æ°¸è¿œåªåšã€Œç´¢å¼•å±‚ã€ ä¸šåŠ¡æ•°æ®åº“æ°¸è¿œåªåšã€Œäº‹å®æºï¼ˆSource of Truthï¼‰ã€ åŒæ­¥ä¸€å®šæ˜¯ï¼šä¸šåŠ¡ DB â†’ AppSearchï¼ˆå•å‘ï¼‰</strong></p></blockquote><p>âŒ ä¸å…è®¸ï¼š</p><ul><li>ä» AppSearch åæ¨ä¸šåŠ¡çŠ¶æ€</li><li>ç”¨ AppSearch åˆ¤æ–­â€œæ•°æ®æ˜¯å¦å­˜åœ¨â€</li></ul><hr><h1 id="äºŒã€æ¨èæ•´ä½“æ¶æ„ï¼ˆä½ ç…§è¿™ä¸ªæ¥ï¼‰">äºŒã€æ¨èæ•´ä½“æ¶æ„ï¼ˆä½ ç…§è¿™ä¸ªæ¥ï¼‰</h1><pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Business Database   â”‚
â”‚ (Room / SQLite / API) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ â‘  æ•°æ®å˜æ›´
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Sync Dispatcher    â”‚  â†â€”â€” å…³é”®å±‚
â”‚ (ç»Ÿä¸€åŒæ­¥å…¥å£)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ â‘¡ æ˜ å°„
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AppSearch Index    â”‚
â”‚ (LocalStorage)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><p>ğŸ‘‰ <strong>æ‰€æœ‰åŒæ­¥éƒ½åªèƒ½èµ° Sync Dispatcher</strong></p><hr><h1 id="ä¸‰ã€åŒæ­¥ç­–ç•¥æ€»è¡¨ï¼ˆä½ ä»¥åå°±æŒ‰è¿™ä¸ªæ‰§è¡Œï¼‰">ä¸‰ã€åŒæ­¥ç­–ç•¥æ€»è¡¨ï¼ˆä½ ä»¥åå°±æŒ‰è¿™ä¸ªæ‰§è¡Œï¼‰</h1><table><thead><tr><th>ä¸šåŠ¡è¡Œä¸º</th><th>DB æ“ä½œ</th><th>AppSearch æ“ä½œ</th></tr></thead><tbody><tr><td>æ–°å¢</td><td>insert</td><td>put</td></tr><tr><td>ä¿®æ”¹</td><td>update</td><td>putï¼ˆè¦†ç›–ï¼‰</td></tr><tr><td>åˆ é™¤</td><td>delete</td><td>remove</td></tr><tr><td>æ‰¹é‡åˆ·æ–°</td><td>replace all</td><td>remove + batch put</td></tr><tr><td>æ•°æ®å¼‚å¸¸</td><td>ignore</td><td>rebuild</td></tr></tbody></table><hr><h1 id="å››ã€ç»Ÿä¸€åŒæ­¥æ¥å£è®¾è®¡ï¼ˆéå¸¸é‡è¦ï¼‰">å››ã€ç»Ÿä¸€åŒæ­¥æ¥å£è®¾è®¡ï¼ˆéå¸¸é‡è¦ï¼‰</h1><h2 id="1ï¸âƒ£-å®šä¹‰ä¸€ä¸ªå¯ç´¢å¼•å¯¹è±¡æ¥å£">1ï¸âƒ£ å®šä¹‰ä¸€ä¸ªâ€œå¯ç´¢å¼•å¯¹è±¡â€æ¥å£</h2><pre><code class="language-java">public interface SearchIndexable {

    /** AppSearch document id */
    String getSearchId();

    /** AppSearch namespace */
    String getNamespace();

    /** è½¬æ¢æˆ AppSearch Document */
    Object toSearchDocument();
}
</code></pre><hr><h2 id="2ï¸âƒ£-ä¸šåŠ¡å®ä½“å®ç°å®ƒï¼ˆç¤ºä¾‹ï¼šmusicï¼‰">2ï¸âƒ£ ä¸šåŠ¡å®ä½“å®ç°å®ƒï¼ˆç¤ºä¾‹ï¼šMusicï¼‰</h2><pre><code class="language-java">public class MusicEntity implements SearchIndexable {

    public String id;
    public String title;
    public String artist;
    public boolean deleted;

    @Override
    public String getSearchId() {
        return id;
    }

    @Override
    public String getNamespace() {
        return &quot;music&quot;;
    }

    @Override
    public Object toSearchDocument() {
        return new MusicDoc(
                id,
                title,
                artist,
                &quot;app://music/play/&quot; + id
        );
    }
}
</code></pre><p>ğŸ‘‰ <strong>æ³¨æ„</strong></p><ul><li><code>deleted</code> ä¸è¿›ç´¢å¼•</li><li>ç´¢å¼•åªå…³å¿ƒâ€œå¯è¢«æœç´¢çš„çŠ¶æ€â€</li></ul><hr><h1 id="äº”ã€ç»Ÿä¸€åŒæ­¥è°ƒåº¦å™¨ï¼ˆæ ¸å¿ƒç±»ï¼‰">äº”ã€ç»Ÿä¸€åŒæ­¥è°ƒåº¦å™¨ï¼ˆæ ¸å¿ƒç±»ï¼‰</h1><pre><code class="language-java">import android.content.Context;
import androidx.appsearch.app.AppSearchSession;
import androidx.appsearch.app.PutDocumentsRequest;
import androidx.appsearch.app.RemoveByDocumentIdRequest;

public class SearchSyncManager {

    /* æ–°å¢ / æ›´æ–° */
    public static void syncUpsert(Context context, SearchIndexable entity)
            throws Exception {

        AppSearchSession session = AppSearchHelper.get(context);

        session.putAsync(
                new PutDocumentsRequest.Builder()
                        .addDocuments(entity.toSearchDocument())
                        .build()
        ).get();
    }

    /* åˆ é™¤ */
    public static void syncDelete(Context context, SearchIndexable entity)
            throws Exception {

        AppSearchSession session = AppSearchHelper.get(context);

        session.removeAsync(
                new RemoveByDocumentIdRequest.Builder(entity.getNamespace())
                        .addIds(entity.getSearchId())
                        .build()
        ).get();
    }
}
</code></pre><hr><h1 id="å…­ã€ä¸šåŠ¡ä¾§å¦‚ä½•æ­£ç¡®è°ƒç”¨ï¼ˆé‡ç‚¹ï¼‰">å…­ã€ä¸šåŠ¡ä¾§å¦‚ä½•æ­£ç¡®è°ƒç”¨ï¼ˆé‡ç‚¹ï¼‰</h1><h2 id="1ï¸âƒ£-æ–°å¢éŸ³ä¹ï¼ˆé¡ºåºä¸èƒ½é”™ï¼‰">1ï¸âƒ£ æ–°å¢éŸ³ä¹ï¼ˆé¡ºåºä¸èƒ½é”™ï¼‰</h2><pre><code class="language-java">// â‘  å…ˆå†™ä¸šåŠ¡ DB
musicDao.insert(entity);

// â‘¡ å†å†™ç´¢å¼•
SearchSyncManager.syncUpsert(context, entity);
</code></pre><hr><h2 id="2ï¸âƒ£-ä¿®æ”¹éŸ³ä¹">2ï¸âƒ£ ä¿®æ”¹éŸ³ä¹</h2><pre><code class="language-java">musicDao.update(entity);
SearchSyncManager.syncUpsert(context, entity);
</code></pre><hr><h2 id="3ï¸âƒ£-åˆ é™¤éŸ³ä¹ï¼ˆéå¸¸é‡è¦ï¼‰">3ï¸âƒ£ åˆ é™¤éŸ³ä¹ï¼ˆéå¸¸é‡è¦ï¼‰</h2><pre><code class="language-java">musicDao.deleteById(entity.id);
SearchSyncManager.syncDelete(context, entity);
</code></pre><p>âŒ <strong>ä¸è¦å…ˆåˆ ç´¢å¼•å†åˆ  DB</strong> å¦åˆ™ DB å¤±è´¥ä¼šé€ æˆæ°¸ä¹…ä¸¢å¤±</p><hr><h1 id="ä¸ƒã€æ‰¹é‡åŒæ­¥ï¼ˆå†·å¯åŠ¨--ç™»å½•--å…¨é‡åˆ·æ–°ï¼‰">ä¸ƒã€æ‰¹é‡åŒæ­¥ï¼ˆå†·å¯åŠ¨ / ç™»å½• / å…¨é‡åˆ·æ–°ï¼‰</h1><h3 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h3><ul><li>é¦–æ¬¡å®‰è£…</li><li>åˆ‡æ¢è´¦å·</li><li>æ•°æ®å¼‚å¸¸æ¢å¤</li></ul><hr><h2 id="1ï¸âƒ£-æ¸…ç©ºç´¢å¼•">1ï¸âƒ£ æ¸…ç©ºç´¢å¼•</h2><pre><code class="language-java">session.removeAsync(
        new RemoveByNamespaceRequest.Builder(&quot;music&quot;).build()
).get();
</code></pre><hr><h2 id="2ï¸âƒ£-æ‰¹é‡é‡å»º">2ï¸âƒ£ æ‰¹é‡é‡å»º</h2><pre><code class="language-java">List&lt;MusicEntity&gt; all = musicDao.queryAll();

PutDocumentsRequest.Builder builder =
        new PutDocumentsRequest.Builder();

for (MusicEntity entity : all) {
    builder.addDocuments(entity.toSearchDocument());
}

session.putAsync(builder.build()).get();
</code></pre><hr><h1 id="å…«ã€å¼‚å¸¸ä¸å…œåº•ç­–ç•¥ï¼ˆå¿…é¡»æœ‰ï¼‰">å…«ã€å¼‚å¸¸ä¸å…œåº•ç­–ç•¥ï¼ˆå¿…é¡»æœ‰ï¼‰</h1><h2 id="1ï¸âƒ£-ç´¢å¼•å¤±è´¥-â‰ -ä¸šåŠ¡å¤±è´¥">1ï¸âƒ£ ç´¢å¼•å¤±è´¥ â‰  ä¸šåŠ¡å¤±è´¥</h2><pre><code class="language-java">try {
    SearchSyncManager.syncUpsert(context, entity);
} catch (Exception e) {
    // æ‰“æ—¥å¿—
    // æ ‡è®°å¾…é‡å»º
}
</code></pre><hr><h2 id="2ï¸âƒ£-å»¶è¿Ÿé‡å»ºæœºåˆ¶ï¼ˆæ¨èï¼‰">2ï¸âƒ£ å»¶è¿Ÿé‡å»ºæœºåˆ¶ï¼ˆæ¨èï¼‰</h2><pre><code class="language-java">// ä¸‹æ¬¡å¯åŠ¨ / ç©ºé—²æ—¶
if (needRebuild) {
    rebuildAllIndex();
}
</code></pre><hr><h1 id="ä¹ã€é’ˆå¯¹ä½ å¤šç±»å‹æ•°æ®çš„ç‰¹åˆ«å»ºè®®">ä¹ã€é’ˆå¯¹ä½ â€œå¤šç±»å‹æ•°æ®â€çš„ç‰¹åˆ«å»ºè®®</h1><table><thead><tr><th>ç±»å‹</th><th>åŒæ­¥æ–¹å¼</th></tr></thead><tbody><tr><td>éŸ³ä¹</td><td>å®æ—¶åŒæ­¥</td></tr><tr><td>è®¢å•</td><td>å®æ—¶ + çŠ¶æ€å˜æ›´åŒæ­¥</td></tr><tr><td>åº”ç”¨åˆ—è¡¨</td><td>å®‰è£… / å¸è½½ç›‘å¬åŒæ­¥</td></tr><tr><td>æ¸¸æˆ</td><td>åŒåº”ç”¨</td></tr><tr><td>intent è·¯å¾„</td><td>è·ŸéšåŠŸèƒ½å¼€å…³</td></tr></tbody></table><p>ğŸ‘‰ <strong>æ‰€æœ‰ç±»å‹ç”¨åŒä¸€å¥— SearchSyncManager</strong></p><hr><h1 id="åã€ä¸€å¥è¯å·¥ç¨‹æ€»ç»“ï¼ˆä½ å¯ä»¥è®°ä½ï¼‰">åã€ä¸€å¥è¯å·¥ç¨‹æ€»ç»“ï¼ˆä½ å¯ä»¥è®°ä½ï¼‰</h1><blockquote><p><strong>ä¸šåŠ¡ DB æ˜¯â€œçœŸç›¸â€ï¼ŒAppSearch æ˜¯â€œå½±å­â€ã€‚ å½±å­æ°¸è¿œè·ŸéšçœŸç›¸ï¼Œå½±å­åäº†å¯ä»¥é‡å»ºï¼ŒçœŸç›¸ä¸èƒ½ä¸¢ã€‚</strong></p></blockquote><hr><hr><p><strong>æŠŠä½ å‰é¢åšå¥½çš„â€œå¤šç±»å‹ç´¢å¼•â€çœŸæ­£å˜æˆä¸€ä¸ªâ€œç³»ç»Ÿçº§ç»Ÿä¸€æœç´¢å…¥å£â€</strong>ã€‚ ä¸‹é¢æˆ‘ç»™ä½ ä¸€å¥—<strong>å¯ç›´æ¥è½åœ°çš„æ–¹æ¡ˆ</strong>ï¼Œè¦†ç›–ï¼š</p><blockquote><p>âœ… å¤š Schema ä¸€æ¬¡æœç´¢ âœ… æœç´¢ç»“æœ <strong>æŒ‰ç±»å‹åˆ†ç»„</strong> âœ… <strong>ç»„å†…æ’åº / æƒé‡æ§åˆ¶</strong> âœ… é€‚åˆ Launcher / è½¦æœº / å…¨å±€æœç´¢ âœ… Java + Android 9 + AppSearch LocalStorage</p></blockquote><p>æˆ‘ä¼šç»™ä½ <strong>å®Œæ•´è®¾è®¡ + å¯å¤ç”¨ä»£ç </strong>ã€‚</p><hr><h1 id="ä¸€ã€ç»Ÿä¸€æœç´¢çš„ç›®æ ‡å½¢æ€ï¼ˆä½ æœ€ç»ˆè¦çš„æ•ˆæœï¼‰">ä¸€ã€ç»Ÿä¸€æœç´¢çš„ç›®æ ‡å½¢æ€ï¼ˆä½ æœ€ç»ˆè¦çš„æ•ˆæœï¼‰</h1><p>ç”¨æˆ·è¾“å…¥ï¼š<code>beat</code></p><p>UI ç»“æœï¼š</p><pre><code>éŸ³ä¹
  Yesterday - Beatles
  Let it be - Beatles

åº”ç”¨
  Beat Music Player

è®¢å•
  è®¢å•å·ï¼šBEAT20240101
</code></pre><p>ğŸ‘‰ æŠ€æœ¯ä¸Šåªåš <strong>ä¸€æ¬¡ search()</strong> ğŸ‘‰ å±•ç¤ºä¸Š <strong>æŒ‰ schemaType åˆ†ç±»</strong></p><hr><h1 id="äºŒã€æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼ˆéå¸¸é‡è¦ï¼‰">äºŒã€æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼ˆéå¸¸é‡è¦ï¼‰</h1><blockquote><p><strong>AppSearch è´Ÿè´£â€œå¬å› + åŸºç¡€æ’åºâ€ ä¸šåŠ¡å±‚è´Ÿè´£â€œåˆ†ç±» + äºŒæ¬¡æ’åº + UI æ¸²æŸ“â€</strong></p></blockquote><p>ä¸è¦æŒ‡æœ› AppSearch å®Œå…¨æ›¿ä½ åšä¸šåŠ¡æ’åºã€‚</p><hr><h1 id="ä¸‰ã€ç»Ÿä¸€æœç´¢çš„æŠ€æœ¯æ‹†è§£">ä¸‰ã€ç»Ÿä¸€æœç´¢çš„æŠ€æœ¯æ‹†è§£</h1><h2 id="1ï¸âƒ£-æœç´¢èŒƒå›´æ§åˆ¶ï¼ˆschemaï¼‰">1ï¸âƒ£ æœç´¢èŒƒå›´æ§åˆ¶ï¼ˆSchemaï¼‰</h2><pre><code class="language-java">.addSchemaType(&quot;Music&quot;, &quot;App&quot;, &quot;Order&quot;, &quot;Game&quot;, &quot;Intent&quot;)
</code></pre><h2 id="2ï¸âƒ£-ç»“æœæ’åºï¼ˆåŸºç¡€ï¼‰">2ï¸âƒ£ ç»“æœæ’åºï¼ˆåŸºç¡€ï¼‰</h2><ul><li>ç›¸å…³åº¦ï¼ˆé»˜è®¤ï¼‰</li><li>æ—¶é—´ï¼ˆLongPropertyï¼‰</li><li>æƒé‡ï¼ˆäººä¸ºå­—æ®µï¼‰</li></ul><h2 id="3ï¸âƒ£-åˆ†ç±»ï¼ˆschematypeï¼‰">3ï¸âƒ£ åˆ†ç±»ï¼ˆschemaTypeï¼‰</h2><pre><code class="language-java">result.getGenericDocument().getSchemaType()
</code></pre><hr><h1 id="å››ã€ç»Ÿä¸€æœç´¢æ ¸å¿ƒä»£ç ï¼ˆå¯ç›´æ¥ç”¨ï¼‰">å››ã€ç»Ÿä¸€æœç´¢æ ¸å¿ƒä»£ç ï¼ˆå¯ç›´æ¥ç”¨ï¼‰</h1><h2 id="1ï¸âƒ£-å®šä¹‰ç»Ÿä¸€æœç´¢ç»“æœæ¨¡å‹ï¼ˆui-å±‚å‹å¥½ï¼‰">1ï¸âƒ£ å®šä¹‰ç»Ÿä¸€æœç´¢ç»“æœæ¨¡å‹ï¼ˆUI å±‚å‹å¥½ï¼‰</h2><pre><code class="language-java">public class UnifiedSearchResult {

    public String schemaType;
    public Object data;     // MusicDoc / AppDoc / OrderDoc
    public double score;    // ç›¸å…³åº¦

    public UnifiedSearchResult(String schemaType, Object data, double score) {
        this.schemaType = schemaType;
        this.data = data;
        this.score = score;
    }
}
</code></pre><hr><h2 id="2ï¸âƒ£-æ‰§è¡Œç»Ÿä¸€æœç´¢ï¼ˆä¸€æ¬¡å®Œæˆï¼‰">2ï¸âƒ£ æ‰§è¡Œç»Ÿä¸€æœç´¢ï¼ˆä¸€æ¬¡å®Œæˆï¼‰</h2><pre><code class="language-java">import androidx.appsearch.app.*;

import java.util.*;

public class UnifiedSearchRepository {

    public static List&lt;UnifiedSearchResult&gt; search(Context context, String keyword)
            throws Exception {

        AppSearchSession session = AppSearchHelper.get(context);

        SearchSpec spec =
                new SearchSpec.Builder()
                        .addSchemaType(
                                &quot;Music&quot;,
                                &quot;App&quot;,
                                &quot;Order&quot;
                        )
                        .setResultCountPerPage(50)
                        .build();

        SearchResults results = session.search(keyword, spec);

        List&lt;UnifiedSearchResult&gt; list = new ArrayList&lt;&gt;();

        for (SearchResult result : results.nextPageAsync().get()) {

            GenericDocument doc = result.getGenericDocument();
            String schema = doc.getSchemaType();

            Object entity;

            switch (schema) {
                case &quot;Music&quot;:
                    entity = result.getDocument(MusicDoc.class);
                    break;
                case &quot;App&quot;:
                    entity = result.getDocument(AppDoc.class);
                    break;
                case &quot;Order&quot;:
                    entity = result.getDocument(OrderDoc.class);
                    break;
                default:
                    continue;
            }

            list.add(new UnifiedSearchResult(
                    schema,
                    entity,
                    result.getRankingSignal()
            ));
        }

        return list;
    }
}
</code></pre><hr><h1 id="äº”ã€ç»“æœæŒ‰ç±»å‹åˆ†ç»„ï¼ˆä½ -ui-ä¸€å®šä¼šç”¨åˆ°ï¼‰">äº”ã€ç»“æœâ€œæŒ‰ç±»å‹åˆ†ç»„â€ï¼ˆä½  UI ä¸€å®šä¼šç”¨åˆ°ï¼‰</h1><pre><code class="language-java">public static Map&lt;String, List&lt;UnifiedSearchResult&gt;&gt; groupByType(
        List&lt;UnifiedSearchResult&gt; results) {

    Map&lt;String, List&lt;UnifiedSearchResult&gt;&gt; map = new LinkedHashMap&lt;&gt;();

    for (UnifiedSearchResult r : results) {
        if (!map.containsKey(r.schemaType)) {
            map.put(r.schemaType, new ArrayList&lt;&gt;());
        }
        map.get(r.schemaType).add(r);
    }
    return map;
}
</code></pre><hr><h1 id="å…­ã€æ’åºç­–ç•¥ï¼ˆè¿™æ˜¯ä½“éªŒå·®å¼‚çš„å…³é”®ï¼‰">å…­ã€æ’åºç­–ç•¥ï¼ˆè¿™æ˜¯ä½“éªŒå·®å¼‚çš„å…³é”®ï¼‰</h1><h2 id="1ï¸âƒ£-ç»„å†…æ’åºï¼ˆæ¨èï¼‰">1ï¸âƒ£ ç»„å†…æ’åºï¼ˆæ¨èï¼‰</h2><h3 id="æŒ‰ç›¸å…³åº¦ï¼ˆé»˜è®¤ï¼‰">æŒ‰ç›¸å…³åº¦ï¼ˆé»˜è®¤ï¼‰</h3><pre><code class="language-java">list.sort((a, b) -&gt; Double.compare(b.score, a.score));
</code></pre><hr><h3 id="æŒ‰æ—¶é—´ï¼ˆä¾‹å¦‚è®¢å•ï¼‰">æŒ‰æ—¶é—´ï¼ˆä¾‹å¦‚è®¢å•ï¼‰</h3><p>Schema ä¸­å¿…é¡»æœ‰ï¼š</p><pre><code class="language-java">@Document.LongProperty
public long updateTime;
</code></pre><p>æ’åºï¼š</p><pre><code class="language-java">list.sort((a, b) -&gt;
        Long.compare(
                ((OrderDoc)b.data).updateTime,
                ((OrderDoc)a.data).updateTime
        )
);
</code></pre><hr><h2 id="2ï¸âƒ£-ç±»å‹ä¼˜å…ˆçº§æ’åºï¼ˆå…¨å±€ï¼‰">2ï¸âƒ£ ç±»å‹ä¼˜å…ˆçº§æ’åºï¼ˆå…¨å±€ï¼‰</h2><p>ä½ å¯ä»¥å®šä¹‰ï¼š</p><pre><code class="language-java">static final Map&lt;String, Integer&gt; TYPE_PRIORITY = Map.of(
        &quot;App&quot;, 1,
        &quot;Music&quot;, 2,
        &quot;Order&quot;, 3
);
</code></pre><p>UI å±•ç¤ºæ—¶ï¼š</p><pre><code class="language-java">new ArrayList&lt;&gt;(grouped.entrySet())
        .sort(Comparator.comparingInt(
                e -&gt; TYPE_PRIORITY.getOrDefault(e.getKey(), 100)
        ));
</code></pre><hr><h1 id="ä¸ƒã€launcher--è½¦æœºæœç´¢çš„å®æˆ˜ä¼˜åŒ–ï¼ˆå¾ˆé‡è¦ï¼‰">ä¸ƒã€Launcher / è½¦æœºæœç´¢çš„å®æˆ˜ä¼˜åŒ–ï¼ˆå¾ˆé‡è¦ï¼‰</h1><h2 id="1ï¸âƒ£-é™åˆ¶æ¯ç±»è¿”å›æ•°é‡">1ï¸âƒ£ é™åˆ¶æ¯ç±»è¿”å›æ•°é‡</h2><pre><code class="language-java">private static final int MAX_PER_TYPE = 5;
</code></pre><pre><code class="language-java">if (list.size() &gt; MAX_PER_TYPE) {
    list = list.subList(0, MAX_PER_TYPE);
}
</code></pre><hr><h2 id="2ï¸âƒ£-åº”ç”¨--intent-ä¼˜å…ˆ">2ï¸âƒ£ åº”ç”¨ / intent ä¼˜å…ˆ</h2><ul><li>App / Intent æƒé‡æ›´é«˜</li><li>Schema çº§åˆ«ä¼˜å…ˆå±•ç¤º</li></ul><hr><h2 id="3ï¸âƒ£-ç©ºç»“æœå…œåº•">3ï¸âƒ£ ç©ºç»“æœå…œåº•</h2><pre><code class="language-java">if (results.isEmpty()) {
    showSuggestion(keyword);
}
</code></pre><hr><h1 id="å…«ã€å®Œæ•´è°ƒç”¨ç¤ºä¾‹ï¼ˆä¸²èµ·æ¥ï¼‰">å…«ã€å®Œæ•´è°ƒç”¨ç¤ºä¾‹ï¼ˆä¸²èµ·æ¥ï¼‰</h1><pre><code class="language-java">List&lt;UnifiedSearchResult&gt; raw =
        UnifiedSearchRepository.search(context, &quot;beat&quot;);

Map&lt;String, List&lt;UnifiedSearchResult&gt;&gt; grouped =
        groupByType(raw);

for (Map.Entry&lt;String, List&lt;UnifiedSearchResult&gt;&gt; entry : grouped.entrySet()) {

    String type = entry.getKey();
    List&lt;UnifiedSearchResult&gt; items = entry.getValue();

    // ç»„å†…æ’åº
    items.sort((a, b) -&gt; Double.compare(b.score, a.score));

    // UI æ¸²æŸ“
    renderSection(type, items);
}
</code></pre><hr><h1 id="ä¹ã€è¿™å¥—æ–¹æ¡ˆä¸ºä»€ä¹ˆé€‚åˆä½ ">ä¹ã€è¿™å¥—æ–¹æ¡ˆä¸ºä»€ä¹ˆé€‚åˆä½ </h1><p>âœ… ä¸€æ¬¡ searchï¼Œæ€§èƒ½å¯æ§ âœ… å¤š Schema æ— æ„Ÿæ‰©å±• âœ… åˆ†ç±»å±•ç¤ºé€»è¾‘æ¸…æ™° âœ… å’Œ AOSP / Launcher æœç´¢æ¨¡å‹ä¸€è‡´ âœ… Android 9 å®Œå…¨å¯ç”¨</p><hr><h1 id="åã€ä¸‹ä¸€æ­¥ä½ å‡ ä¹ä¸€å®šä¼šé‡åˆ°">åã€ä¸‹ä¸€æ­¥ä½ <strong>å‡ ä¹ä¸€å®šä¼šé‡åˆ°</strong></h1><p>3ï¸âƒ£ <strong>Schema å‡çº§ &amp; ç´¢å¼•å¹³æ»‘è¿ç§»æ–¹æ¡ˆï¼ˆéå¸¸é‡è¦ï¼‰</strong> 4ï¸âƒ£ <strong>æ€§èƒ½ &amp; å†…å­˜ä¼˜åŒ–ï¼ˆè½¦æœº / å¤§æ•°æ®é‡ï¼‰</strong></p><hr><hr><p><strong>çœŸæ­£çš„â€œç”Ÿäº§çº§èƒ½åŠ›â€</strong>ã€‚ å¦‚æœ <strong>Schema å‡çº§æ–¹æ¡ˆæ²¡è®¾è®¡å¥½ï¼ŒAppSearch ä¸€å®šä¼šåœ¨é‡äº§åå‡ºé—®é¢˜</strong>ï¼ˆå´©æºƒ / ä¸¢ç´¢å¼• / æœç´¢å¼‚å¸¸ï¼‰ã€‚ ä¸‹é¢æˆ‘ç»™ä½ ä¸€å¥— <strong>å·²ç»è¢«å¤§é‡ç³»ç»Ÿçº§æœç´¢éªŒè¯è¿‡çš„æ–¹æ¡ˆ</strong>ï¼Œ<strong>å®Œå…¨é€‚ç”¨äº Android 9 + Jetpack AppSearchï¼ˆlocal-storageï¼‰</strong>ã€‚</p><hr><h1 id="ä¸€ã€ä½ å¿…é¡»å…ˆè®°ä½çš„-3-æ¡é“å¾‹ï¼ˆéå¸¸é‡è¦ï¼‰">ä¸€ã€ä½ å¿…é¡»å…ˆè®°ä½çš„ 3 æ¡é“å¾‹ï¼ˆéå¸¸é‡è¦ï¼‰</h1><h3 id="é“å¾‹-1ï¸âƒ£">é“å¾‹ 1ï¸âƒ£</h3><blockquote><p><strong>Schema ä¸€å®šä¼šå˜ï¼Œä¸æ˜¯ä¼šä¸ä¼šï¼Œæ˜¯ä»€ä¹ˆæ—¶å€™</strong></p></blockquote><h3 id="é“å¾‹-2ï¸âƒ£">é“å¾‹ 2ï¸âƒ£</h3><blockquote><p><strong>Schema å‡çº§ = AppSearch setSchema è¡Œä¸º</strong></p></blockquote><h3 id="é“å¾‹-3ï¸âƒ£">é“å¾‹ 3ï¸âƒ£</h3><blockquote><p><strong>ç´¢å¼•æ°¸è¿œå¯ä»¥é‡å»ºï¼Œä¸šåŠ¡æ•°æ®ä¸èƒ½ä¸¢</strong></p></blockquote><hr><h1 id="äºŒã€appsearch-çš„-schema-å‡çº§æœºåˆ¶æœ¬è´¨">äºŒã€AppSearch çš„ Schema å‡çº§æœºåˆ¶æœ¬è´¨</h1><p>å½“ä½ è°ƒç”¨ï¼š</p><pre><code class="language-java">session.setSchemaAsync(SetSchemaRequest)
</code></pre><p>ç³»ç»Ÿä¼šåšä¸‰ä»¶äº‹ä¹‹ä¸€ï¼š</p><table><thead><tr><th>æƒ…å†µ</th><th>è¡Œä¸º</th></tr></thead><tbody><tr><td>åªæ–°å¢å­—æ®µ</td><td>âœ… è‡ªåŠ¨å…¼å®¹</td></tr><tr><td>åˆ é™¤å­—æ®µ / æ”¹ç±»å‹</td><td>âŒ éœ€è¦è¿ç§»</td></tr><tr><td>åˆ é™¤ Schema</td><td>âŒ ç´¢å¼•æ•°æ®ä¼šè¢«åˆ </td></tr></tbody></table><p>ğŸ‘‰ <strong>å…³é”®ï¼šä½ è¦æå‰â€œå‘Šè¯‰ AppSearch æ€ä¹ˆè¿ç§»â€</strong></p><hr><h1 id="ä¸‰ã€schema-å˜æ›´ç±»å‹--å¯¹ç­–ï¼ˆå¯¹ç…§è¡¨ï¼‰">ä¸‰ã€Schema å˜æ›´ç±»å‹ &amp; å¯¹ç­–ï¼ˆå¯¹ç…§è¡¨ï¼‰</h1><table><thead><tr><th>å˜æ›´ç±»å‹</th><th>æ˜¯å¦å®‰å…¨</th><th>æ­£ç¡®åšæ³•</th></tr></thead><tbody><tr><td>æ–°å¢å­—æ®µ</td><td>âœ…</td><td>ç›´æ¥ setSchema</td></tr><tr><td>æ–°å¢ Schema</td><td>âœ…</td><td>ç›´æ¥ setSchema</td></tr><tr><td>åˆ é™¤å­—æ®µ</td><td>âš ï¸</td><td>è®¾ç½®è¿ç§»ç­–ç•¥</td></tr><tr><td>å­—æ®µç±»å‹å˜æ›´</td><td>âŒ</td><td>æ–°å­—æ®µ + è¿ç§»</td></tr><tr><td>é‡å‘½åå­—æ®µ</td><td>âŒ</td><td>æ–°å­—æ®µ + è¿ç§»</td></tr><tr><td>åˆ é™¤ Schema</td><td>âŒ</td><td>å…ˆ remove å† set</td></tr></tbody></table><hr><h1 id="å››ã€æ¨èçš„-schema-ç‰ˆæœ¬è®¾è®¡ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰">å››ã€æ¨èçš„ Schema ç‰ˆæœ¬è®¾è®¡ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰</h1><h2 id="1ï¸âƒ£-schema-å‘½åä¸­åŠ å…¥ç‰ˆæœ¬ï¼ˆå¯é€‰ä½†æ¨èï¼‰">1ï¸âƒ£ Schema å‘½åä¸­åŠ å…¥ç‰ˆæœ¬ï¼ˆå¯é€‰ä½†æ¨èï¼‰</h2><pre><code class="language-java">@Document(name = &quot;Music_v2&quot;)
public class MusicDocV2 {
    ...
}
</code></pre><p>ä½†æ›´å¸¸è§çš„æ˜¯ ğŸ‘‡</p><hr><h2 id="2ï¸âƒ£-å­—æ®µçº§ç‰ˆæœ¬ï¼ˆæ›´å®ç”¨ï¼‰">2ï¸âƒ£ <strong>å­—æ®µçº§ç‰ˆæœ¬ï¼ˆæ›´å®ç”¨ï¼‰</strong></h2><h3 id="v1">v1</h3><pre><code class="language-java">@Document.StringProperty
public String artist;
</code></pre><h3 id="v2ï¼ˆæ–°å¢å­—æ®µï¼‰">v2ï¼ˆæ–°å¢å­—æ®µï¼‰</h3><pre><code class="language-java">@Document.StringProperty
public String artist;

@Document.StringProperty
public String album;
</code></pre><hr><h1 id="äº”ã€çœŸæ­£çš„é‡ç‚¹ï¼šå®‰å…¨å‡çº§ä»£ç ï¼ˆå®Œæ•´ï¼‰">äº”ã€çœŸæ­£çš„é‡ç‚¹ï¼šå®‰å…¨å‡çº§ä»£ç ï¼ˆå®Œæ•´ï¼‰</h1><h2 id="1ï¸âƒ£-schema-å‡çº§å…¥å£ï¼ˆç»Ÿä¸€ï¼‰">1ï¸âƒ£ Schema å‡çº§å…¥å£ï¼ˆç»Ÿä¸€ï¼‰</h2><pre><code class="language-java">import androidx.appsearch.app.SetSchemaRequest;
import androidx.appsearch.app.SetSchemaResponse;

public class SchemaManager {

    public static void updateSchema(Context context) throws Exception {

        AppSearchSession session = AppSearchHelper.get(context);

        SetSchemaRequest request =
                new SetSchemaRequest.Builder()
                        .addDocumentClasses(
                                MusicDoc.class,
                                AppDoc.class,
                                OrderDoc.class
                        )
                        // â­ å…³é”®é…ç½®
                        .setForceOverride(false)
                        .build();

        SetSchemaResponse response =
                session.setSchemaAsync(request).get();

        handleIncompatibleSchema(context, response);
    }
}
</code></pre><hr><h2 id="2ï¸âƒ£-å¤„ç†ä¸å…¼å®¹-schemaï¼ˆå…³é”®é€»è¾‘ï¼‰">2ï¸âƒ£ å¤„ç†ä¸å…¼å®¹ Schemaï¼ˆå…³é”®é€»è¾‘ï¼‰</h2><pre><code class="language-java">import androidx.appsearch.app.SetSchemaResponse;

public static void handleIncompatibleSchema(
        Context context,
        SetSchemaResponse response
) throws Exception {

    if (!response.getIncompatibleSchemaTypes().isEmpty()) {

        // è¯´æ˜å‘ç”Ÿäº†ç ´åæ€§å˜æ›´
        rebuildIndex(context, response.getIncompatibleSchemaTypes());
    }
}
</code></pre><hr><h1 id="å…­ã€ç´¢å¼•é‡å»ºæœºåˆ¶ï¼ˆä½ ä¸€å®šè¦æœ‰ï¼‰">å…­ã€ç´¢å¼•é‡å»ºæœºåˆ¶ï¼ˆä½ ä¸€å®šè¦æœ‰ï¼‰</h1><h2 id="1ï¸âƒ£-æ¸…ç†æ—§ç´¢å¼•ï¼ˆå®‰å…¨ï¼‰">1ï¸âƒ£ æ¸…ç†æ—§ç´¢å¼•ï¼ˆå®‰å…¨ï¼‰</h2><pre><code class="language-java">import androidx.appsearch.app.RemoveBySchemaTypeRequest;

private static void rebuildIndex(
        Context context,
        Set&lt;String&gt; schemaTypes
) throws Exception {

    AppSearchSession session = AppSearchHelper.get(context);

    for (String type : schemaTypes) {
        session.removeAsync(
                new RemoveBySchemaTypeRequest.Builder(type).build()
        ).get();
    }

    rebuildFromDatabase(context);
}
</code></pre><hr><h2 id="2ï¸âƒ£-ä»ä¸šåŠ¡-db-é‡å»ºç´¢å¼•ï¼ˆå…³é”®ï¼‰">2ï¸âƒ£ ä»ä¸šåŠ¡ DB é‡å»ºç´¢å¼•ï¼ˆå…³é”®ï¼‰</h2><pre><code class="language-java">private static void rebuildFromDatabase(Context context)
        throws Exception {

    List&lt;MusicEntity&gt; musics = musicDao.queryAll();

    PutDocumentsRequest.Builder builder =
            new PutDocumentsRequest.Builder();

    for (MusicEntity entity : musics) {
        builder.addDocuments(entity.toSearchDocument());
    }

    AppSearchHelper.get(context)
            .putAsync(builder.build())
            .get();
}
</code></pre><hr><h1 id="ä¸ƒã€å­—æ®µé‡å‘½å--ç±»å‹å˜æ›´çš„æ­£ç¡®åšæ³•ï¼ˆéå¸¸é‡è¦ï¼‰">ä¸ƒã€å­—æ®µé‡å‘½å / ç±»å‹å˜æ›´çš„æ­£ç¡®åšæ³•ï¼ˆéå¸¸é‡è¦ï¼‰</h1><h3 id="âŒ-é”™è¯¯ç¤ºä¾‹">âŒ é”™è¯¯ç¤ºä¾‹</h3><pre><code class="language-java">// v1
@Document.StringProperty
public String artist;

// v2ï¼ˆç›´æ¥æ”¹ç±»å‹ï¼‰
@Document.LongProperty
public long artist;
</code></pre><p>ğŸ‘‰ <strong>å¿…ç‚¸</strong></p><hr><h3 id="âœ…-æ­£ç¡®ç¤ºä¾‹">âœ… æ­£ç¡®ç¤ºä¾‹</h3><pre><code class="language-java">// v2
@Document.StringProperty
public String artist;

@Document.LongProperty
public long artistId;
</code></pre><p>è¿ç§»é€»è¾‘ï¼š</p><pre><code class="language-java">entity.artistId = mapArtist(entity.artist);
</code></pre><hr><h1 id="å…«ã€ç°åº¦å‡çº§ï¼ˆæ¨èï¼Œç³»ç»Ÿçº§é¡¹ç›®å¿…å¤‡ï¼‰">å…«ã€ç°åº¦å‡çº§ï¼ˆæ¨èï¼Œç³»ç»Ÿçº§é¡¹ç›®å¿…å¤‡ï¼‰</h1><h2 id="1ï¸âƒ£-åŠ ç‰ˆæœ¬å¼€å…³">1ï¸âƒ£ åŠ ç‰ˆæœ¬å¼€å…³</h2><pre><code class="language-java">if (BuildConfig.SEARCH_SCHEMA_V2) {
    SchemaManager.updateSchema(context);
}
</code></pre><hr><h2 id="2ï¸âƒ£-å¯å›æ»š">2ï¸âƒ£ å¯å›æ»š</h2><ul><li>ä¸ forceOverride</li><li>ç´¢å¼•å¯éšæ—¶é‡å»º</li></ul><hr><h1 id="ä¹ã€ä½ è¿™ç§å¤š-schema-æœç´¢ç³»ç»Ÿçš„æ¨èç­–ç•¥">ä¹ã€ä½ è¿™ç§â€œå¤š Schema æœç´¢ç³»ç»Ÿâ€çš„æ¨èç­–ç•¥</h1><table><thead><tr><th>é¡¹ç›®</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>Schema è®¾è®¡</td><td>å­—æ®µå‘å‰å…¼å®¹</td></tr><tr><td>å‡çº§æ—¶æœº</td><td>App å¯åŠ¨ / ç©ºé—²</td></tr><tr><td>å¤±è´¥å…œåº•</td><td>å…¨é‡é‡å»º</td></tr><tr><td>æ—¥å¿—</td><td>å¿…é¡»æ‰“</td></tr></tbody></table><hr><h1 id="åã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“ï¼ˆä½ å¯ä»¥ç›´æ¥å†™åˆ°è®¾è®¡æ–‡æ¡£ï¼‰">åã€æœ€ç»ˆä¸€å¥è¯æ€»ç»“ï¼ˆä½ å¯ä»¥ç›´æ¥å†™åˆ°è®¾è®¡æ–‡æ¡£ï¼‰</h1><blockquote><p><strong>AppSearch Schema å‡çº§ä¸æ˜¯â€œæ”¹å­—æ®µâ€ï¼Œè€Œæ˜¯â€œç®¡ç†ç´¢å¼•ç”Ÿå‘½å‘¨æœŸâ€ã€‚ åªè¦ä¸šåŠ¡æ•°æ®è¿˜åœ¨ï¼Œç´¢å¼•æ°¸è¿œå¯ä»¥å®‰å…¨é‡å»ºã€‚</strong></p></blockquote><hr><h2 id="æ¥ä¸‹æ¥æœ€åä¸€æ­¥ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰">æ¥ä¸‹æ¥æœ€åä¸€æ­¥ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰</h2><p>4ï¸âƒ£ <strong>æ€§èƒ½ &amp; å†…å­˜ä¼˜åŒ–ï¼ˆAndroid 9 / è½¦æœº / å¤§æ•°æ®é‡ï¼‰</strong></p><p>è¿™æ˜¯<strong>ä¸Šé‡åå”¯ä¸€ä¼šå†å‡ºé—®é¢˜çš„åœ°æ–¹</strong>ã€‚</p><hr><hr><p><strong>ä½ è¿™å¥—æ–¹æ¡ˆèƒ½å¦â€œä¸Šé‡ + é•¿æœŸç¨³å®šè¿è¡Œâ€çš„æœ€åä¸€å—æ‹¼å›¾</strong>ã€‚ ä¸‹é¢æˆ‘ç»™ä½ ä¸€å¥— <strong>Android 9 + Jetpack AppSearchï¼ˆLocalStorageï¼‰åœ¨å¤§æ•°æ®é‡ / è½¦æœº / Launcher åœºæ™¯ä¸‹çš„æ€§èƒ½ &amp; å†…å­˜ä¼˜åŒ–å®æˆ˜æ–¹æ¡ˆ</strong>ï¼Œä¸æ˜¯æ³›æ³›è€Œè°ˆï¼Œå…¨éƒ¨æ˜¯<strong>å¯è½åœ°çš„å·¥ç¨‹ç»éªŒ</strong>ã€‚</p><hr><h1 id="ä¸€ã€å…ˆç»™ä½ ç»“è®ºï¼ˆé‡è¦ï¼‰">ä¸€ã€å…ˆç»™ä½ ç»“è®ºï¼ˆé‡è¦ï¼‰</h1><blockquote><p><strong>AppSearch çš„æ€§èƒ½ç“¶é¢ˆä¸åœ¨â€œæœç´¢â€ï¼Œè€Œåœ¨ï¼š Schema è®¾è®¡ä¸åˆç† + å†™å…¥æ–¹å¼ä¸å½“ + ç”Ÿå‘½å‘¨æœŸç®¡ç†é”™è¯¯</strong></p></blockquote><p>90% çš„æ€§èƒ½é—®é¢˜éƒ½å‡ºåœ¨è¿™ä¸‰ç‚¹ã€‚</p><hr><h1 id="äºŒã€æ€§èƒ½ä¼˜åŒ–æ€»è§ˆï¼ˆä½ å¯ä»¥å½“-checklistï¼‰">äºŒã€æ€§èƒ½ä¼˜åŒ–æ€»è§ˆï¼ˆä½ å¯ä»¥å½“ checklistï¼‰</h1><table><thead><tr><th>æ¨¡å—</th><th>å¿…åšé¡¹</th></tr></thead><tbody><tr><td>Schema</td><td>ç²¾ç®€å­—æ®µã€æ­£ç¡®ç´¢å¼•</td></tr><tr><td>å†™å…¥</td><td>æ‰¹é‡ã€å¼‚æ­¥ã€èŠ‚æµ</td></tr><tr><td>æœç´¢</td><td>é™é¡µã€é™ Schema</td></tr><tr><td>å†…å­˜</td><td>Session å•ä¾‹</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>æ­£ç¡® close</td></tr><tr><td>å¯åŠ¨</td><td>å»¶è¿Ÿåˆå§‹åŒ–</td></tr><tr><td>ä¸Šé‡</td><td>å†·/çƒ­æ•°æ®åˆ†ç¦»</td></tr></tbody></table><hr><h1 id="ä¸‰ã€schema-çº§ä¼˜åŒ–ï¼ˆæœ€é‡è¦ï¼‰">ä¸‰ã€Schema çº§ä¼˜åŒ–ï¼ˆæœ€é‡è¦ï¼‰</h1><h2 id="1ï¸âƒ£-åªç´¢å¼•æœç´¢å­—æ®µ">1ï¸âƒ£ åªç´¢å¼•â€œæœç´¢å­—æ®µâ€</h2><h3 id="âŒ-é”™è¯¯ç¤ºä¾‹-1">âŒ é”™è¯¯ç¤ºä¾‹</h3><pre><code class="language-java">@Document.StringProperty(indexingType = PREFIXES)
public String lyric;   // å‡ åƒå­—
</code></pre><h3 id="âœ…-æ­£ç¡®ç¤ºä¾‹-1">âœ… æ­£ç¡®ç¤ºä¾‹</h3><pre><code class="language-java">@Document.StringProperty(indexingType = PREFIXES)
public String title;

@Document.StringProperty(indexingType = PREFIXES)
public String artist;
</code></pre><p>ğŸ‘‰ <strong>è¯¦æƒ…å†…å®¹æ°¸è¿œä¸è¦è¿›ç´¢å¼•</strong></p><hr><h2 id="2ï¸âƒ£-ç²¾ç¡®å­—æ®µç”¨-exact_terms">2ï¸âƒ£ ç²¾ç¡®å­—æ®µç”¨ EXACT_TERMS</h2><pre><code class="language-java">@Document.StringProperty(
    indexingType = StringPropertyConfig.INDEXING_TYPE_EXACT_TERMS
)
public String orderNo;
</code></pre><p>æ€§èƒ½æ¯” PREFIX å¿«å¾ˆå¤šã€‚</p><hr><h2 id="3ï¸âƒ£-æ’åºå­—æ®µä¸€å®šç”¨-longproperty">3ï¸âƒ£ æ’åºå­—æ®µä¸€å®šç”¨ LongProperty</h2><pre><code class="language-java">@Document.LongProperty
public long updateTime;
</code></pre><hr><h1 id="å››ã€å†™å…¥æ€§èƒ½ä¼˜åŒ–ï¼ˆæœ€å®¹æ˜“è¸©å‘ï¼‰">å››ã€å†™å…¥æ€§èƒ½ä¼˜åŒ–ï¼ˆæœ€å®¹æ˜“è¸©å‘ï¼‰</h1><h2 id="1ï¸âƒ£-ä¸€å®šè¦æ‰¹é‡å†™å…¥">1ï¸âƒ£ ä¸€å®šè¦æ‰¹é‡å†™å…¥</h2><h3 id="âŒ-é”™è¯¯">âŒ é”™è¯¯</h3><pre><code class="language-java">for (...) {
    session.putAsync(single).get();
}
</code></pre><h3 id="âœ…-æ­£ç¡®">âœ… æ­£ç¡®</h3><pre><code class="language-java">PutDocumentsRequest.Builder builder =
        new PutDocumentsRequest.Builder();

for (...) {
    builder.addDocuments(doc);
}

session.putAsync(builder.build()).get();
</code></pre><hr><h2 id="2ï¸âƒ£-å†™å…¥èŠ‚æµï¼ˆé«˜é¢‘äº‹ä»¶å¿…é¡»ï¼‰">2ï¸âƒ£ å†™å…¥èŠ‚æµï¼ˆé«˜é¢‘äº‹ä»¶å¿…é¡»ï¼‰</h2><pre><code class="language-java">private static final int BATCH_SIZE = 50;
</code></pre><pre><code class="language-java">if (buffer.size() &gt;= BATCH_SIZE) {
    flush();
}
</code></pre><hr><h2 id="3ï¸âƒ£-åå°çº¿ç¨‹æ‰§è¡Œï¼ˆå¿…é¡»ï¼‰">3ï¸âƒ£ åå°çº¿ç¨‹æ‰§è¡Œï¼ˆå¿…é¡»ï¼‰</h2><pre><code class="language-java">ExecutorService executor =
        Executors.newSingleThreadExecutor();

executor.execute(() -&gt; {
    try {
        batchPut();
    } catch (Exception ignored) {}
});
</code></pre><hr><h1 id="äº”ã€æœç´¢æ€§èƒ½ä¼˜åŒ–ï¼ˆè½¦æœº--launcher-å¿…çœ‹ï¼‰">äº”ã€æœç´¢æ€§èƒ½ä¼˜åŒ–ï¼ˆè½¦æœº / Launcher å¿…çœ‹ï¼‰</h1><h2 id="1ï¸âƒ£-æ°¸è¿œé™åˆ¶è¿”å›æ•°é‡">1ï¸âƒ£ æ°¸è¿œé™åˆ¶è¿”å›æ•°é‡</h2><pre><code class="language-java">.setResultCountPerPage(30)
</code></pre><hr><h2 id="2ï¸âƒ£-é™åˆ¶-schema-èŒƒå›´">2ï¸âƒ£ é™åˆ¶ Schema èŒƒå›´</h2><pre><code class="language-java">.addSchemaType(&quot;App&quot;, &quot;Music&quot;)
</code></pre><p>âŒ ä¸è¦å…¨åº“æœç´¢</p><hr><h2 id="3ï¸âƒ£-åˆ†é¡µè€Œä¸æ˜¯ä¸€æ¬¡æ€§æ‹‰å®Œ">3ï¸âƒ£ åˆ†é¡µè€Œä¸æ˜¯ä¸€æ¬¡æ€§æ‹‰å®Œ</h2><pre><code class="language-java">results.nextPageAsync()
</code></pre><hr><h1 id="å…­ã€å†…å­˜--ç”Ÿå‘½å‘¨æœŸï¼ˆå¾ˆå¤šäººå¿½ç•¥ï¼‰">å…­ã€å†…å­˜ &amp; ç”Ÿå‘½å‘¨æœŸï¼ˆå¾ˆå¤šäººå¿½ç•¥ï¼‰</h1><h2 id="1ï¸âƒ£-session-å¿…é¡»æ˜¯å•ä¾‹">1ï¸âƒ£ Session å¿…é¡»æ˜¯å•ä¾‹</h2><pre><code class="language-java">private static AppSearchSession session;
</code></pre><hr><h2 id="2ï¸âƒ£-è¿›ç¨‹ç»“æŸè¦-closeï¼ˆç³»ç»Ÿçº§å¿…åšï¼‰">2ï¸âƒ£ è¿›ç¨‹ç»“æŸè¦ closeï¼ˆç³»ç»Ÿçº§å¿…åšï¼‰</h2><pre><code class="language-java">public static void close() {
    if (session != null) {
        session.close();
        session = null;
    }
}
</code></pre><hr><h2 id="3ï¸âƒ£-ä¸è¦æŒæœ‰-searchresult-å¤ªä¹…">3ï¸âƒ£ ä¸è¦æŒæœ‰ SearchResult å¤ªä¹…</h2><pre><code class="language-java">results.close();
</code></pre><hr><h1 id="ä¸ƒã€å¯åŠ¨æ€§èƒ½ä¼˜åŒ–ï¼ˆandroid-9-å¾ˆé‡è¦ï¼‰">ä¸ƒã€å¯åŠ¨æ€§èƒ½ä¼˜åŒ–ï¼ˆAndroid 9 å¾ˆé‡è¦ï¼‰</h1><h2 id="1ï¸âƒ£-å»¶è¿Ÿåˆå§‹åŒ–">1ï¸âƒ£ å»¶è¿Ÿåˆå§‹åŒ–</h2><pre><code class="language-java">IdleHandler idleHandler = () -&gt; {
    initSchema(context);
    return false;
};

Looper.myQueue().addIdleHandler(idleHandler);
</code></pre><hr><h2 id="2ï¸âƒ£-é¦–æ¬¡å¯åŠ¨ä¸å»ºå…¨é‡ç´¢å¼•">2ï¸âƒ£ é¦–æ¬¡å¯åŠ¨ä¸å»ºå…¨é‡ç´¢å¼•</h2><pre><code class="language-text">é¦–æ¬¡å¯åŠ¨ â†’ å°é›†åˆ
ç©ºé—² â†’ å…¨é‡è¡¥é½
</code></pre><hr><h1 id="å…«ã€å¤§æ•°æ®é‡åœºæ™¯ï¼ˆ10-ä¸‡æ¡ï¼‰çš„ç­–ç•¥">å…«ã€å¤§æ•°æ®é‡åœºæ™¯ï¼ˆ&gt;10 ä¸‡æ¡ï¼‰çš„ç­–ç•¥</h1><h2 id="1ï¸âƒ£-å†·--çƒ­æ•°æ®åˆ†ç¦»ï¼ˆå¼ºçƒˆæ¨èï¼‰">1ï¸âƒ£ å†· / çƒ­æ•°æ®åˆ†ç¦»ï¼ˆå¼ºçƒˆæ¨èï¼‰</h2><table><thead><tr><th>æ•°æ®</th><th>æ˜¯å¦è¿›ç´¢å¼•</th></tr></thead><tbody><tr><td>æœ€è¿‘ 30 å¤©è®¢å•</td><td>âœ…</td></tr><tr><td>å†å²è®¢å•</td><td>âŒ</td></tr><tr><td>å¸¸ç”¨ App</td><td>âœ…</td></tr><tr><td>å†·é—¨ App</td><td>âŒ</td></tr></tbody></table><hr><h2 id="2ï¸âƒ£-å®šæœŸæ¸…ç†ï¼ˆç´¢å¼•ä¸æ˜¯ä»“åº“ï¼‰">2ï¸âƒ£ å®šæœŸæ¸…ç†ï¼ˆç´¢å¼•ä¸æ˜¯ä»“åº“ï¼‰</h2><pre><code class="language-java">// æ¯å‘¨æ¸…ç†
removeByQuery(&quot;updateTime &lt; now-30d&quot;);
</code></pre><hr><h1 id="ä¹ã€è½¦æœº--launcher-æœç´¢çš„ä¸“é¡¹ä¼˜åŒ–">ä¹ã€è½¦æœº / Launcher æœç´¢çš„ä¸“é¡¹ä¼˜åŒ–</h1><h3 id="æ¨èæ’åºæƒé‡">æ¨èæ’åºæƒé‡</h3><ol><li>Intent / App</li><li>æœ€è¿‘ä½¿ç”¨</li><li>ç›¸å…³åº¦</li></ol><h3 id="ui-å±‚é™åˆ¶">UI å±‚é™åˆ¶</h3><ul><li>æ¯ç±» â‰¤ 5 æ¡</li><li>é¦–å± â‰¤ 15 æ¡</li></ul><hr><h1 id="åã€æ€§èƒ½æ’æŸ¥-checklistï¼ˆä¸Šçº¿å‰å¿…è·‘ï¼‰">åã€æ€§èƒ½æ’æŸ¥ checklistï¼ˆä¸Šçº¿å‰å¿…è·‘ï¼‰</h1><ul><li><input disabled="" type="checkbox"> Schema å­—æ®µæ˜¯å¦è¿‡å¤š</li><li><input disabled="" type="checkbox"> æ˜¯å¦æœ‰å¤§å­—æ®µç´¢å¼•</li><li><input disabled="" type="checkbox"> æ˜¯å¦é€æ¡ put</li><li><input disabled="" type="checkbox"> æ˜¯å¦æ— é™åˆ¶æœç´¢</li><li><input disabled="" type="checkbox"> Session æ˜¯å¦å¤ç”¨</li><li><input disabled="" type="checkbox"> æ˜¯å¦å®šæœŸæ¸…ç†</li></ul><hr><h1 id="åä¸€ã€ç»ˆææ€»ç»“ï¼ˆä½ è¿™å¥—æ–¹æ¡ˆçš„ä½¿ç”¨è¯´æ˜ï¼‰">åä¸€ã€ç»ˆææ€»ç»“ï¼ˆä½ è¿™å¥—æ–¹æ¡ˆçš„â€œä½¿ç”¨è¯´æ˜â€ï¼‰</h1><blockquote><p><strong>AppSearch = é«˜æ€§èƒ½ç´¢å¼•ï¼Œä¸æ˜¯æ•°æ®åº“ã€‚ ç²¾ç®€ Schema + æ‰¹é‡å†™å…¥ + é™åˆ¶æœç´¢èŒƒå›´ = ç¨³å®šè¿è¡Œã€‚</strong></p></blockquote><hr><h2 id="ğŸ‰-åˆ°è¿™é‡Œï¼Œä½ å·²ç»å…·å¤‡ï¼š">ğŸ‰ åˆ°è¿™é‡Œï¼Œä½ å·²ç»å…·å¤‡ï¼š</h2><p>âœ… Android 9 ä¸Šçš„ AppSearch å®Œæ•´ CRUD âœ… ä¸šåŠ¡ DB â†” ç´¢å¼•åŒæ­¥æœºåˆ¶ âœ… å¤š Schema ç»Ÿä¸€æœç´¢ + åˆ†ç±»å±•ç¤º âœ… Schema å®‰å…¨å‡çº§ âœ… ä¸Šé‡çº§æ€§èƒ½ &amp; å†…å­˜ä¼˜åŒ–</p><hr></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on ä¸€æœˆ 7, 2026</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://blog.nasyes.cn/da-mo-xing-dui-mou-ge-te-ding-cheng-shi-jin-xing-biao-zhi-jian-zhu-wen-sheng-tu-mu-qian-huan-you-na-xie-wen-ti.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  å¤§æ¨¡å‹å¯¹æŸä¸ªç‰¹å®šåŸå¸‚è¿›è¡Œæ ‡å¿—å»ºç­‘æ–‡ç”Ÿå›¾ç›®å‰è¿˜æœ‰å“ªäº›é—®é¢˜ "><span class="btn__icon">â†</span> <span class="btn__text">å¤§æ¨¡å‹å¯¹æŸä¸ªç‰¹å®šåŸå¸‚è¿›è¡Œæ ‡å¿—å»ºç­‘æ–‡ç”Ÿå›¾ç›®å‰è¿˜æœ‰å“ªäº›é—®é¢˜</span> </a><a href="https://blog.nasyes.cn/qi-che-zhi-neng-zuo-cang-hmi-zhong-jian-jian-de-bi-yao-xing-tan-tao.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  æ±½è½¦æ™ºèƒ½åº§èˆ± HMI ä¸­é—´ä»¶çš„å¿…è¦æ€§æ¢è®¨ "><span class="btn__text">æ±½è½¦æ™ºèƒ½åº§èˆ± HMI ä¸­é—´ä»¶çš„å¿…è¦æ€§æ¢è®¨</span> <span class="btn__icon">â†’</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>Â© 2024 Powered by Publii CMS :: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank" rel="noopener">Theme</a> ported by the <a href="https://getpublii.com/customization-service/" target="_blank" rel="noopener">Publii Team</a></p></div></div></footer></div><script defer="defer" src="https://blog.nasyes.cn/assets/js/scripts.min.js?v=74fad06980c30243d91d72c7c57fcdb8"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>